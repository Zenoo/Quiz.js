class Quiz{constructor(t){t=t||[];const e=[];this._timeLimit=null,this.wrapper=null,this._timer=null,this._timerInterval=null,this._timerStarted=null,this.answers=[],this._onTimerStartCallbacks=[],this._onAnswerCallbacks=[],this._onEndCallbacks=[],this._listenToCustomEvents(t,e)}_listenToCustomEvents(t,e){document.addEventListener("quiz.js-addQuestions",({detail:e})=>{this._addQuestionsHandler(t,e)}),document.addEventListener("quiz.js-removeQuestions",({detail:e})=>{this._removeQuestionsHandler(t,e)}),document.addEventListener("quiz.js-start",({detail:s})=>{e=isNaN(s)?s:this._selectQuestions(t,s>t.length?t.length:s),this._displayQuestion(e,0)})}_addQuestionsHandler(t,e){t.push(...e.filter(e=>!t.find(t=>t.id==e.id)))}_removeQuestionsHandler(t,e){t=t.filter(t=>!e.includes(t.id))}_selectQuestions(t,e){const s=t.slice(0);for(let t=s.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[s[t],s[e]]=[s[e],s[t]]}return s.slice(0,e)}_displayQuestion(t,e){this.wrapper.querySelector(".quiz-js-question").innerHTML=t[e].title,this._shuffleArray(t[e].answers),this.wrapper.querySelector(".quiz-js-answers").innerHTML=t[e].answers.map(t=>`\n\t\t\t<div>\n\t\t\t\t<button data-value="${t.value}">${t.title}</button>\n\t\t\t</div>\n\t\t`).join(""),this._listenToUserAnswer(t,e),this._timeLimit&&(this._timer.parentElement.classList.remove("quiz-js-hidden"),this._resetTimer(t,e)),this.wrapper.querySelector(".quiz-js-next").classList.add("quiz-js-hidden")}_shuffleArray(t){for(let e=t.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}}_listenToUserAnswer(t,e){this.wrapper.querySelectorAll(".quiz-js-answers button").forEach(s=>{s.addEventListener("click",()=>{const i=new Date-this._timerStarted;clearInterval(this._timerInterval),this.answers.push({id:t[e].id,answer:s.getAttribute("data-value"),correct:t[e].answer==s.getAttribute("data-value"),time:i}),this._displayQuestionInformations(t,e,s.getAttribute("data-value")),this._onAnswerCallbacks.forEach(r=>{Reflect.apply(r,null,[t[e],{value:s.getAttribute("data-value"),correct:t[e].answer==s.getAttribute("data-value"),time:i}])})})})}_resetTimer(t,e){const s=this.wrapper.querySelector(".quiz-js-time-text");this._timer.style.width="100%",this._timerStarted=new Date,s.textContent=(this._timeLimit/1e3).toFixed(2)+"s",this._onTimerStartCallbacks.forEach(t=>{Reflect.apply(t,null,[this._timer.parentElement])}),this._timerInterval=setInterval(()=>{const i=(new Date-this._timerStarted)/this._timeLimit;i<1?(this._timer.style.width=100-100*i+"%",s.textContent=((this._timeLimit-this._timeLimit*i)/1e3).toFixed(2)+"s"):(clearInterval(this._timerInterval),this.answers.find(s=>s.id==t[e].id)||(this.answers.push({id:t[e].id,answer:"",time:this._timeLimit}),this._displayQuestionInformations(t,e),this._onAnswerCallbacks.forEach(s=>{Reflect.apply(s,null,[t[e],{value:"",time:this._timeLimit}])})))},10)}_displayQuestionInformations(t,e,s=""){t[e].answers.forEach(i=>{const r=this.wrapper.querySelector(`.quiz-js-answers button[data-value="${i.value}"]`);r.disabled=!0,s==i.value&&r.classList.add("quiz-js-answer-clicked"),i.value==t[e].answer&&r.classList.add("quiz-js-answer-correct"),r.innerHTML=`\n\t\t\t\t<span class="quiz-js-answer-percentage">${i.chosenPercentage}%</span>\n\t\t\t\t<span>${i.title}</span>\n\t\t\t`});const i=this.wrapper.querySelector(".quiz-js-next").cloneNode(!0);this.wrapper.querySelector(".quiz-js-next").replaceWith(i),i.classList.remove("quiz-js-hidden"),i.addEventListener("click",()=>{e+1<t.length?this._displayQuestion(t,e+1):this._displayEnd()})}_displayEnd(){this.wrapper.querySelector(".quiz-js-question").classList.add("quiz-js-hidden"),this.wrapper.querySelector(".quiz-js-answers").classList.add("quiz-js-hidden"),this._timeLimit&&this.wrapper.querySelector(".quiz-js-time-limit").classList.add("quiz-js-hidden"),this.wrapper.querySelector(".quiz-js-next").classList.add("quiz-js-hidden"),this.wrapper.querySelector(".quiz-js-results").classList.remove("quiz-js-hidden"),this.wrapper.querySelector(".quiz-js-ok span").textContent=this.answers.filter(t=>t.correct).length,this.wrapper.querySelector(".quiz-js-error span").textContent=this.answers.filter(t=>!t.correct).length,this._onEndCallbacks.forEach(t=>{Reflect.apply(t,null,[this.answers])})}addQuestions(...t){return document.dispatchEvent(new CustomEvent("quiz.js-addQuestions",{detail:t})),this}removeQuestions(...t){return document.dispatchEvent(new CustomEvent("quiz.js-removeQuestions",{detail:t})),this}setTimeLimit(t){return this._timeLimit=t,this}attachTo(t){return this.wrapper=t instanceof Element?t:document.querySelector(t),this.wrapper.classList.add("quiz-js-wrapper"),this.wrapper.innerHTML=`\n\t\t\t<div class="quiz-js-question" data-id=""></div>\n\t\t\t<div class="quiz-js-answers"></div>\n\t\t\t${this._timeLimit?'<div class="quiz-js-time-limit quiz-js-hidden"><div class="quiz-js-time-left"></div><div class="quiz-js-time-text"></div></div>':""}\n\t\t\t<button class="quiz-js-next quiz-js-hidden">&#10095;</button>\n\t\t\t<div class="quiz-js-results quiz-js-hidden">\n\t\t\t\t<p class="quiz-js-ok"><span></span> &#10004;</p>\n\t\t\t\t<p class="quiz-js-error"><span></span> &#10008;</p>\n\t\t\t</div>\n\t\t`,this._timer=this.wrapper.querySelector(".quiz-js-time-left"),this}start(t){return this.wrapper&&(!isNaN(t)&&t>0||isNaN(t)&&t.length)?document.dispatchEvent(new CustomEvent("quiz.js-start",{detail:t})):t?console.warn("Quiz.js: You didn't specify an Element to run the Quiz in. Use %c.attachTo()%c.","font-weight: bold; font-family: monospace",""):console.warn("Quiz.js: The amount of questions must be greater than 0"),this}onTimerStart(t){return this._onTimerStartCallbacks.push(t),this}onAnswer(t){return this._onAnswerCallbacks.push(t),this}onEnd(t){return this._onEndCallbacks.push(t),this}offTimerStart(){return this._onTimerStartCallbacks=[],this}offAnswer(){return this._onAnswerCallbacks=[],this}offEnd(){return this._onEndCallbacks=[],this}reset(){clearInterval(this._timerInterval),this._timerStarted=null,this.answers=[];const t=this.wrapper.querySelector(".quiz-js-question"),e=this.wrapper.querySelector(".quiz-js-answers");return t.setAttribute("data-id",""),t.classList.remove("quiz-js-hidden"),t.innerHTML="",e.innerHTML="",e.classList.remove("quiz-js-hidden"),this.wrapper.querySelector(".quiz-js-time-limit").classList.add("quiz-js-hidden"),this.wrapper.querySelector(".quiz-js-results").classList.add("quiz-js-hidden"),this}}